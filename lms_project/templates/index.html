{% extends 'base.html' %}
{% load static %}
{% load cache %}
{% block content %}

<form id="form" method="get">
    {{ form }}
    <button type="submit">Получить</button>
</form>

<div class="courses_container">
    {% cache 300 course_short_info request.user %}
    {% for course in courses %}
    <div class="course_preview">
        <p><a href="{% url 'detail' course.pk %}"> {{ course.title|title }} </a></p>

        {% if not course.pk in request.session.favourites or not request.session.favourites %}
        <div id="favourite_container">
            <form id="favourite_form" method="post" action="{% url 'add_booking' course.pk %}" title="Принять участие">
                {% csrf_token %}
                <button type="submit" class="fa fa-plus" style="color: #fa9405"></button>
            </form>
        </div>
        {% else %}
        <div id="favourite_container">
            <form id="favourite_form" method="post" action="{% url 'remove_booking' course.pk %}"
                  title="Принять участие">
                {% csrf_token %}
                <button type="submit" class="fa fa-check" style="color: green"></button>
            </form>
        </div>
        {% endif %}

        <p> {{course.start_date|date:"j E"}} </p>
        <p> {{course.description|capfirst}} </p>
        <p><span class="price">{{ course.price|default:"Бесплатно" }} Р </span></p>
    </div>
    {% empty %}
    <p>На данный момент не найдено не одного курса. Проверьте страницу позже.</p>
    {% endfor %}
    {% endcache %}
</div>

<div>
    <span>
        {% if page_obj.has_previous %}
        <a href="?page=1">К первой</a>
        <a href="?page={{ page_obj.previous_page_number }}">Назад</a>
        {% endif %}
        <span>Страница {{ page_obj.number }} из {{ page_obj.paginator.num_page }}</span>
        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}">Вперёд</a>
            <a href="?page={{ page_obj.paginator.num_pages }}">В конец</a>
        {% endif %}
    </span>
</div>
    {% endblock %}